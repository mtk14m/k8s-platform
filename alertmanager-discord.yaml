apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: discord-config
  namespace: monitoring
  labels:
    release: monitoring-stack
spec:
  routes:
    # On groupe les alertes par nom pour Ã©viter les spams
    groupBy: ["alertname"]
    groupWait: 30s
    groupInterval: 5m
    repeatInterval: 12h
    #on envoie tout vers discord
    receiver: "discord-webhook"

---
receivers:
  - name: 'discord-webhook'
    discordConfigs:
    - webhookUrl:
        key: url
        name: discord-webhook-secret # Le nom du secret crÃ©Ã© Ã  l'Ã©tape 2
        optional: false
      title: 'ðŸ”¥ ALERTE INFRA : {{ .GroupLabels.alertname }}'
      message: '{{ .CommonAnnotations.summary }} - {{ .CommonAnnotations.description }}'